<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Shape derivative versus Gâteaux derivative in varphi · GridapTopOpt.jl</title><meta name="title" content="Shape derivative versus Gâteaux derivative in varphi · GridapTopOpt.jl"/><meta property="og:title" content="Shape derivative versus Gâteaux derivative in varphi · GridapTopOpt.jl"/><meta property="twitter:title" content="Shape derivative versus Gâteaux derivative in varphi · GridapTopOpt.jl"/><meta name="description" content="Documentation for GridapTopOpt.jl."/><meta property="og:description" content="Documentation for GridapTopOpt.jl."/><meta property="twitter:description" content="Documentation for GridapTopOpt.jl."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.svg" alt="GridapTopOpt.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">GridapTopOpt.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><a class="tocitem" href="../../../getting-started/">Getting Started</a></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../../../reference/optimisers/">Optimisers</a></li><li><a class="tocitem" href="../../../reference/chainrules/">ChainRules</a></li><li><a class="tocitem" href="../../../reference/levelsetevolution/">LevelSetEvolution</a></li><li><a class="tocitem" href="../../../reference/velext/">Velocity extension</a></li><li><a class="tocitem" href="../../../reference/io/">IO</a></li><li><a class="tocitem" href="../../../reference/utilities/">Utilities</a></li><li><a class="tocitem" href="../../../reference/benchmarking/">Benchmarking</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Shape derivative versus Gâteaux derivative in <span>$\varphi$</span></a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Shape derivative versus Gâteaux derivative in <span>$\varphi$</span></a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/zjwegert/GridapTopOpt.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/zjwegert/GridapTopOpt.jl/blob/main/docs/src/deprecated/dev/shape_der.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Shape-derivative-versus-Gâteaux-derivative-in-\\varphi"><a class="docs-heading-anchor" href="#Shape-derivative-versus-Gâteaux-derivative-in-\\varphi">Shape derivative versus Gâteaux derivative in <span>$\varphi$</span></a><a id="Shape-derivative-versus-Gâteaux-derivative-in-\\varphi-1"></a><a class="docs-heading-anchor-permalink" href="#Shape-derivative-versus-Gâteaux-derivative-in-\\varphi" title="Permalink"></a></h1><p>The shape derivative of <span>$J^\prime(\Omega)$</span> can be defined as the Fréchet derivative under a mapping <span>$\tilde\Omega = (\boldsymbol{I}+\boldsymbol{\theta})(\Omega)$</span> at <span>$\boldsymbol{0}$</span> with</p><p class="math-container">\[J(\tilde{\Omega})=J(\Omega)+J^\prime(\Omega)(\boldsymbol{\theta})+o(\lVert\boldsymbol{\theta}\rVert).\]</p><p>Consider some illustrative examples. First suppose that <span>$J_1(\Omega)=\int_\Omega f(\boldsymbol{x})~\mathrm{d}\boldsymbol{x}$</span>, then</p><p class="math-container">\[J_1(\tilde{\Omega})=\int_{\tilde{\Omega}}f(\tilde{\boldsymbol{x}})~\mathrm{d}\boldsymbol{x}=\int_{\Omega}f(\boldsymbol{x}+\boldsymbol{\theta})\left\lvert\frac{\partial\boldsymbol{\tilde{x}}}{\partial\boldsymbol{x}}\right\rvert~\mathrm{d}\boldsymbol{x}=...=J(\Omega)+\int_{\partial\Omega}f(\boldsymbol{x})~\boldsymbol{\theta}\cdot\boldsymbol{n}~\mathrm{d}s+...\]</p><p>So, for this simple case <span>$J_1^\prime(\Omega)(\boldsymbol{\theta})=\int_{\partial\Omega}f(\boldsymbol{x})~\boldsymbol{\theta}\cdot\boldsymbol{n}~\mathrm{d}s~~(\star).$</span> For a surface integral <span>$J_2(\Omega)=\int_{\partial\Omega} f(\boldsymbol{x})~\mathrm{d}s$</span>, one finds in a similar way <span>$J_2^\prime(\Omega)(\boldsymbol{\theta})=\int_{\partial\Omega}(f\nabla\cdot\boldsymbol{n}+\nabla f\cdot\boldsymbol{n})~\boldsymbol{\theta}\cdot\boldsymbol{n}~\mathrm{d}s.$</span></p><p>Suppose that we attribute a signed distance function <span>$\varphi:D\rightarrow\mathbb{R}$</span> to our domain <span>$\Omega\subset D$</span> with <span>$\bar{\Omega}=\lbrace \boldsymbol{x}:\varphi(\boldsymbol{x})\leq0\rbrace$</span> and <span>$\Omega^\complement=\lbrace \boldsymbol{x}:\varphi(\boldsymbol{x})&gt;0\rbrace$</span>. We can then define a smooth characteristic function <span>$\chi_\epsilon:\mathbb{R}\rightarrow[\epsilon,1]$</span> as <span>$\chi_\epsilon(\varphi)=(1-H(\varphi))+\epsilon H(\varphi)$</span> where <span>$H$</span> is a smoothed Heaviside function with smoothing radius <span>$\eta$</span>, and <span>$\epsilon\ll1$</span> allows for an ersatz material approximation. Of course, <span>$\epsilon$</span> can be taken as zero depending on the considered integral and/or computational regime. We can now rewrite <span>$J_1$</span> over the computational domain <span>$D$</span> as <span>$J_{1\Omega}(\varphi)=\int_D \chi_\epsilon(\varphi)f(\boldsymbol{x})~\mathrm{d}\boldsymbol{x}$</span>. Considering the directional derivative of <span>$J_{1\Omega}$</span> under a variation <span>$\tilde{\varphi}=\varphi+sv$</span> gives</p><p class="math-container">\[J_{1\Omega}^\prime(\varphi)(v)=\frac{\mathrm{d}}{\mathrm{d}s} J_{1\Omega}(\varphi+sv)\rvert_{s=0}=\int_D v\chi_\epsilon^\prime(\varphi)f(\boldsymbol{x})~\mathrm{d}\boldsymbol{x}\]</p><p>or</p><p class="math-container">\[J_{1\Omega}^\prime(\varphi)(v)=\int_D (\epsilon-1)vH^\prime(\varphi)f(\boldsymbol{x})~\mathrm{d}\boldsymbol{x}.\]</p><p>The final result of course does not yet match <span>$(\star)$</span>. Over a fixed computational domain we may relax integrals to be over all of <span>$D$</span> via <span>$\mathrm{d}s = H&#39;(\varphi)\lvert\nabla\varphi\rvert~\mathrm{d}\boldsymbol{x}$</span>. In addition suppose we take <span>$\boldsymbol{\theta}=-v\boldsymbol{n}$</span>. Then <span>$(\star)$</span> can be rewritten as</p><p class="math-container">\[J_1^\prime(\Omega)(-v\boldsymbol{n})=-\int_{D}vf(\boldsymbol{x})H&#39;(\varphi)\lvert\nabla\varphi\rvert~\mathrm{d}s.\]</p><p>As <span>$\varphi$</span> is a signed distance function we have <span>$\lvert\nabla\varphi\rvert=1$</span> for <span>$D\setminus\Sigma$</span> where <span>$\Sigma$</span> is the skeleton of <span>$\Omega$</span> and <span>$\Omega^\complement$</span>. Furthermore, <span>$H&#39;(\varphi)$</span> provides support only within a band of <span>$\partial\Omega$</span>.</p><div class="admonition is-success"><header class="admonition-header">Result I</header><div class="admonition-body"><p>Therefore, we have that almost everywhere</p><p class="math-container">\[{\huge{|}} J_1^\prime(\Omega)(-v\boldsymbol{n}) - J_{1\Omega}^\prime(\varphi)(v){\huge{|}}=O(\epsilon),\]</p><p>with equaility as <span>$\epsilon\rightarrow0$</span>.</p></div></div><p>This is not the case when we consider applying the same process to a surface integral such as <span>$J_2(\Omega)$</span>. In this case, we can never recover <span>$\nabla f$</span> under a variation of <span>$\varphi$</span>. For argument sake we can take <span>$J_{2\Omega}(\varphi)=\int_D f(\boldsymbol{x})H&#39;(\varphi)\lvert\nabla\varphi\rvert~\mathrm{d}\boldsymbol{x}$</span>. Then a variation in <span>$\varphi$</span> gives</p><p class="math-container">\[J_{2\Omega}^\prime(\varphi)(v)=\int_D f(\boldsymbol{x})\left(H^{\prime\prime}(\varphi)\lvert\nabla\varphi\rvert v + H^\prime(\varphi)\frac{\nabla v\cdot\nabla \varphi}{\lvert\nabla\varphi\rvert}\right)~\mathrm{d}\boldsymbol{x}.\]</p><p>On the other hand, relaxing the shape derivative of <span>$J_2$</span> in the same way as above gives</p><p class="math-container">\[J_2^\prime(\Omega)(-v\boldsymbol{n})=\int_{D}-\left(f\nabla\cdot\frac{\nabla\varphi}{\lvert\nabla\varphi\rvert}+\nabla f\cdot\frac{\nabla\varphi}{\lvert\nabla\varphi\rvert}\right)vH&#39;(\varphi)\lvert\nabla\varphi\rvert~\mathrm{d}\boldsymbol{x}.\]</p><h2 id="Adding-PDE-constraints"><a class="docs-heading-anchor" href="#Adding-PDE-constraints">Adding PDE constraints</a><a id="Adding-PDE-constraints-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-PDE-constraints" title="Permalink"></a></h2><p>Consider <span>$\Omega\subset D$</span> with <span>$J(\Omega)=\int_\Omega j(\boldsymbol{u})~\mathrm{d}\boldsymbol{x}+\int_{\Gamma_N} l_1(\boldsymbol{u})~\mathrm{d}s+\int_{\Gamma_R} l_2(\boldsymbol{u})~\mathrm{d}s$</span> where <span>$\boldsymbol{u}$</span> satisfies</p><p class="math-container">\[\begin{aligned}
-\mathrm{div}(\boldsymbol{C\varepsilon}(\boldsymbol{u})) &amp;= \boldsymbol{f}\text{ on }\Omega, \\
\boldsymbol{u} &amp;= \boldsymbol{0}\text{ on }\Gamma_D,\\
\boldsymbol{C\varepsilon}(\boldsymbol{u})\boldsymbol{n} &amp;= \boldsymbol{0}\text{ on }\Gamma_0,\\
\boldsymbol{C\varepsilon}(\boldsymbol{u})\boldsymbol{n} &amp;= \boldsymbol{g}\text{ on }\Gamma_N,\\
\boldsymbol{C\varepsilon}(\boldsymbol{u})\boldsymbol{n} &amp;= -\boldsymbol{w}(\boldsymbol{u})\text{ on }\Gamma_R.\\
\end{aligned}\]</p><p>In the above <span>$\boldsymbol{\varepsilon}$</span> is the strain tensor, <span>$\boldsymbol{C}$</span> is the stiffness tensor, <span>$\Gamma_0 = \partial\Omega\setminus(\Gamma_D\cup\Gamma_N\cup\Gamma_R)$</span>, and <span>$\Gamma_D$</span>, <span>$\Gamma_N$</span>, <span>$\Gamma_R$</span> are required to be fixed.</p><h3 id="Shape-derivative"><a class="docs-heading-anchor" href="#Shape-derivative">Shape derivative</a><a id="Shape-derivative-1"></a><a class="docs-heading-anchor-permalink" href="#Shape-derivative" title="Permalink"></a></h3><p>Let us first consider the shape derivative of <span>$J$</span>. Disregarding embedding inside the computational domain <span>$D$</span>, the above strong form can be written in weak form as:</p><p><span>$\quad$</span> <em>Find</em> <span>$\boldsymbol{u}\in H^1_{\Gamma_D}(\Omega)^d$</span> <em>such that</em></p><p class="math-container">\[\int_{\Omega} \boldsymbol{C\varepsilon}(\boldsymbol{u})\boldsymbol{\varepsilon}(\boldsymbol{v})~\mathrm{d}\boldsymbol{x}+\int_{\Gamma_R}\boldsymbol{w}(\boldsymbol{u})\cdot\boldsymbol{v}~\mathrm{d}s=\int_\Omega \boldsymbol{f}\cdot\boldsymbol{v}~\mathrm{d}\boldsymbol{x}+\int_{\Gamma_N}\boldsymbol{g}\cdot\boldsymbol{v}~\mathrm{d}s,~\forall \boldsymbol{v}\in H^1_{\Gamma_D}(\Omega)^d.\]</p><p>Following Céa&#39;s formal adjoint method we introduce the following Lagrangian</p><p class="math-container">\[\begin{aligned}
\mathcal{L}(\Omega,\boldsymbol{v},\boldsymbol{q})=&amp;\int_\Omega j(\boldsymbol{v})~\mathrm{d}\boldsymbol{x}+\int_{\Gamma_N} l_1(\boldsymbol{v})~\mathrm{d}s+\int_{\Gamma_R} l_2(\boldsymbol{v})~\mathrm{d}s+\int_{\Omega} \boldsymbol{C\varepsilon}(\boldsymbol{v})\boldsymbol{\varepsilon}(\boldsymbol{q})~\mathrm{d}\boldsymbol{x}\\
&amp;+\int_{\Gamma_R}\boldsymbol{w}(\boldsymbol{v})\cdot\boldsymbol{q}~\mathrm{d}s-\int_\Omega \boldsymbol{f}\cdot\boldsymbol{q}~\mathrm{d}\boldsymbol{x}-\int_{\Gamma_N}\boldsymbol{g}\cdot\boldsymbol{q}~\mathrm{d}s\\
&amp;-\int_{\Gamma_D}\boldsymbol{q}\cdot\boldsymbol{C\varepsilon}(\boldsymbol{v})\boldsymbol{n}+\boldsymbol{v}\cdot\boldsymbol{C\varepsilon}(\boldsymbol{q})\boldsymbol{n}~\mathrm{d}s\\
\end{aligned}\]</p><p>where <span>$\boldsymbol{v},\boldsymbol{q}\in H^1(\mathbb{R}^d)^d$</span>. Requiring stationarity of the Lagrangian and taking a partial derivative of <span>$\mathcal{L}$</span> with respect to <span>$\boldsymbol{q}$</span> in the direction <span>$\boldsymbol{\phi}\in H^1(\mathbb{R}^d)^d$</span> gives</p><p class="math-container">\[\begin{aligned}
0=\frac{\partial\mathcal{L}}{\partial\boldsymbol{q}}(\boldsymbol{\phi})&amp;=\int_{\Omega} \boldsymbol{C\varepsilon}(\boldsymbol{v})\boldsymbol{\varepsilon}(\boldsymbol{\phi})~\mathrm{d}\boldsymbol{x}+\int_{\Gamma_R}\boldsymbol{w}(\boldsymbol{v})\cdot\boldsymbol{\phi}~\mathrm{d}s-\int_\Omega \boldsymbol{f}\cdot\boldsymbol{\phi}~\mathrm{d}\boldsymbol{x}-\int_{\Gamma_N}\boldsymbol{g}\cdot\boldsymbol{\phi}~\mathrm{d}s\\
&amp;\quad-\int_{\Gamma_D}\boldsymbol{\phi}\cdot\boldsymbol{C\varepsilon}(\boldsymbol{v})\boldsymbol{n}+\boldsymbol{v}\cdot\boldsymbol{C\varepsilon}(\boldsymbol{\phi})\boldsymbol{n}~\mathrm{d}s\\
&amp;=\int_\Omega\boldsymbol{\phi}\cdot(-\mathrm{div}(\boldsymbol{C\varepsilon}(\boldsymbol{u}))-\boldsymbol{f})~\mathrm{d}\boldsymbol{x}+\int_{\Gamma_R}\boldsymbol{\phi}\cdot(\boldsymbol{C\varepsilon}(\boldsymbol{v})\boldsymbol{n}+\boldsymbol{w}(\boldsymbol{v}))~\mathrm{d}s\\
&amp;\quad+\int_{\Gamma_N}\boldsymbol{\phi}\cdot(\boldsymbol{C\varepsilon}(\boldsymbol{v})\boldsymbol{n}-\boldsymbol{g})~\mathrm{d}s-\int_{\Gamma_D}\boldsymbol{v}\cdot\boldsymbol{C\varepsilon}(\boldsymbol{\phi})\boldsymbol{n}~\mathrm{d}s+\int_{\Gamma_0}\boldsymbol{\phi}\cdot\boldsymbol{C\varepsilon}(\boldsymbol{v})\boldsymbol{n}~\mathrm{d}s
\end{aligned}\]</p><p>after applying integration by parts. Under a suitable variations of <span>$\boldsymbol{\phi}$</span>, the state equation and boundary conditions are generated as required. In other words, <span>$\boldsymbol{v}$</span> is given by the solution <span>$\boldsymbol{u}$</span> to the equations of state. We can derive the adjoint equation by again requiring stationarity of the Lagrangian and taking a partial derivative of <span>$\mathcal{L}$</span> with respect to <span>$\boldsymbol{v}$</span> in the direction <span>$\boldsymbol{\phi}\in H^1(\mathbb{R}^d)^d$</span>. This gives</p><p class="math-container">\[\begin{aligned}
0=\frac{\partial\mathcal{L}}{\partial\boldsymbol{v}}(\boldsymbol{\phi})&amp;=\int_\Omega \boldsymbol{\phi}\cdot j^\prime(\boldsymbol{v})~\mathrm{d}\boldsymbol{x}+\int_{\Gamma_N} \boldsymbol{\phi}\cdot l_1^\prime(\boldsymbol{v})~\mathrm{d}s+\int_{\Gamma_R} \boldsymbol{\phi}\cdot l_2^\prime(\boldsymbol{v})~\mathrm{d}s+\int_{\Omega} \boldsymbol{C\varepsilon}(\boldsymbol{\phi})\boldsymbol{\varepsilon}(\boldsymbol{q})~\mathrm{d}\boldsymbol{x}\\
&amp;\quad+\int_{\Gamma_R}\boldsymbol{\phi}\cdot w^\prime(\boldsymbol{v})\cdot\boldsymbol{q}~\mathrm{d}s-\int_{\Gamma_D}\boldsymbol{q}\cdot\boldsymbol{C\varepsilon}(\boldsymbol{\phi})\boldsymbol{n}+\boldsymbol{\phi}\cdot\boldsymbol{C\varepsilon}(\boldsymbol{q})\boldsymbol{n}~\mathrm{d}s\\
&amp;=\int_{\Omega} \boldsymbol{\phi}\cdot(-\mathrm{div}(\boldsymbol{C\varepsilon}(\boldsymbol{q}))-j^\prime(\boldsymbol{v}))~\mathrm{d}\boldsymbol{x}+\int_{\Gamma_N} \boldsymbol{\phi}\cdot (\boldsymbol{C\varepsilon}(\boldsymbol{q})\boldsymbol{n}+l_1^\prime(\boldsymbol{v}))~\mathrm{d}s\\
&amp;\quad+\int_{\Gamma_R} \boldsymbol{\phi}\cdot (\boldsymbol{C\varepsilon}(\boldsymbol{q})\boldsymbol{n}+w^\prime(\boldsymbol{v})\cdot\boldsymbol{q}+l_2^\prime(\boldsymbol{v}))~\mathrm{d}s-\int_{\Gamma_D}\boldsymbol{q}\cdot\boldsymbol{C\varepsilon}(\boldsymbol{\phi})\boldsymbol{n}~\mathrm{d}s\\
&amp;\quad+\int_{\Gamma_0}\boldsymbol{\phi}\cdot\boldsymbol{C\varepsilon}(\boldsymbol{q})\boldsymbol{n}~\mathrm{d}s
\end{aligned}\]</p><p>where integration by parts has been applied. The adjoint equations are then generated under suitable variations of <span>$\boldsymbol{\phi}$</span>, while the previous result <span>$\boldsymbol{v}=\boldsymbol{u}$</span> implies that we can identify a unique <span>$\boldsymbol{q}=\boldsymbol{\lambda}$</span> that satisfies stationaity. In particular,</p><p class="math-container">\[\begin{aligned}
-\mathrm{div}(\boldsymbol{C\varepsilon}(\boldsymbol{\lambda})) &amp;= j^\prime(\boldsymbol{u})\text{ on }\Omega, \\
\boldsymbol{\lambda} &amp;= \boldsymbol{0}\text{ on }\Gamma_D,\\
\boldsymbol{C\varepsilon}(\boldsymbol{\lambda})\boldsymbol{n} &amp;= \boldsymbol{0} \text{ on }\Gamma_0,\\
\boldsymbol{C\varepsilon}(\boldsymbol{\lambda})\boldsymbol{n} &amp;= -l_1^\prime(\boldsymbol{u})\text{ on }\Gamma_N,\\
\boldsymbol{C\varepsilon}(\boldsymbol{\lambda})\boldsymbol{n} &amp;= -w^\prime(\boldsymbol{u})\cdot\boldsymbol{\lambda}-l_2^\prime(\boldsymbol{u}) \text{ on }\Gamma_R.\\
\end{aligned}\]</p><p>The shape derivative of <span>$J(\Omega)=\mathcal{L}(\Omega,\boldsymbol{u},\boldsymbol{\lambda})$</span> then follows by application of the chainrule along with the shape derivative results for <span>$J_1$</span> and <span>$J_2$</span> above:</p><p class="math-container">\[\begin{aligned}
J^\prime(\Omega)(\boldsymbol{\theta})&amp;=\frac{\partial\mathcal{L}}{\partial\Omega}(\Omega,\boldsymbol{u},\boldsymbol{\lambda})(\boldsymbol{\theta})+\cancel{\frac{\partial\mathcal{L}}{\partial\boldsymbol{v}}(\Omega,\boldsymbol{u},\boldsymbol{\lambda})}(\boldsymbol{u}^\prime(\boldsymbol{\theta}))+\cancel{\frac{\partial\mathcal{L}}{\partial\boldsymbol{q}}(\Omega,\boldsymbol{u},\boldsymbol{\lambda})}(\boldsymbol{\lambda}^\prime(\boldsymbol{\theta}))\\
&amp;=\int_{\Gamma_0} (\boldsymbol{C\varepsilon}(\boldsymbol{u})\boldsymbol{\varepsilon}(\boldsymbol{\lambda})+j(\boldsymbol{u}) -\boldsymbol{f}\cdot\boldsymbol{\lambda})~\boldsymbol{\theta}\cdot\boldsymbol{n}~\mathrm{d}s.
\end{aligned}\]</p><p>As required. Note that in the above, we have used that <span>$\boldsymbol{\theta}\cdot\boldsymbol{n}=0$</span> on <span>$\Gamma_N$</span>, <span>$\Gamma_R$</span>, and <span>$\Gamma_D$</span>.</p><h3 id="Gâteaux-derivative-in-\\varphi"><a class="docs-heading-anchor" href="#Gâteaux-derivative-in-\\varphi">Gâteaux derivative in <span>$\varphi$</span></a><a id="Gâteaux-derivative-in-\\varphi-1"></a><a class="docs-heading-anchor-permalink" href="#Gâteaux-derivative-in-\\varphi" title="Permalink"></a></h3><p>Let us now return to derivatives of <span>$J$</span> with respect to <span>$\varphi$</span> over the whole computational domain. As previously, suppose that we rewrite <span>$J$</span> as</p><p class="math-container">\[\hat{\mathcal{J}}(\varphi)=\int_D (1-H(\varphi))j(\boldsymbol{u})~\mathrm{d}\boldsymbol{x}+\int_{\Gamma_N} l_1(\boldsymbol{u})~\mathrm{d}s+\int_{\Gamma_R} l_2(\boldsymbol{u})~\mathrm{d}s\]</p><p>where <span>$\boldsymbol{u}$</span> satisfies the state equations as previously with relaxation over the whole computational domain <span>$D$</span> as</p><p class="math-container">\[\begin{aligned}
-\mathrm{div}(\chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{u})) &amp;= (1-H(\varphi))\boldsymbol{f}\text{ on }D, \\
\boldsymbol{u} &amp;= \boldsymbol{0}\text{ on }\Gamma_D,\\
\chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{u})\boldsymbol{n} &amp;= \boldsymbol{0}\text{ on }\Gamma_0,\\
\chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{u})\boldsymbol{n} &amp;= \boldsymbol{g}\text{ on }\Gamma_N,\\
\chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{u})\boldsymbol{n} &amp;= -\boldsymbol{w}(\boldsymbol{u})\text{ on }\Gamma_R,\\
\end{aligned}\]</p><p>and admits a weak form: <em>Find</em> <span>$\boldsymbol{u}\in H^1_{\Gamma_D}(\Omega)^d$</span> <em>such that</em></p><p class="math-container">\[\int_D \chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{u})\boldsymbol{\varepsilon}(\boldsymbol{v})~\mathrm{d}\boldsymbol{x}+\int_{\Gamma_R}\boldsymbol{w}(\boldsymbol{u})\cdot\boldsymbol{v}~\mathrm{d}s=\int_D(1-H(\varphi))\boldsymbol{f}\cdot\boldsymbol{v}~\mathrm{d}\boldsymbol{x}+\int_{\Gamma_N}\boldsymbol{g}\cdot\boldsymbol{v}~\mathrm{d}s,~\forall \boldsymbol{v}\in H^1_{\Gamma_D}(\Omega)^d.\]</p><p>At this stage it is important to note that this is almost verbatim as the case without relaxation over <span>$D$</span>. Indeed, we may follow Céa&#39;s method as previously with only a minor adjustment to the Lagrangian that relaxes it over <span>$D$</span>:</p><p class="math-container">\[\begin{aligned}
\hat{\mathcal{L}}(\varphi,\boldsymbol{v},\boldsymbol{q})=&amp;\int_D (1-H(\varphi))j(\boldsymbol{v})~\mathrm{d}\boldsymbol{x}+\int_{\Gamma_N} l_1(\boldsymbol{v})~\mathrm{d}s+\int_{\Gamma_R} l_2(\boldsymbol{v})~\mathrm{d}s+\int_{D}\chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{v})\boldsymbol{\varepsilon}(\boldsymbol{q})~\mathrm{d}\boldsymbol{x}\\
&amp;+\int_{\Gamma_R}\boldsymbol{w}(\boldsymbol{v})\cdot\boldsymbol{q}~\mathrm{d}s-\int_D (1-H(\varphi)) \boldsymbol{f}\cdot\boldsymbol{q}~\mathrm{d}\boldsymbol{x}-\int_{\Gamma_N}\boldsymbol{g}\cdot\boldsymbol{q}~\mathrm{d}s\\
&amp;-\int_{\Gamma_D}\boldsymbol{q}\cdot\chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{v})\boldsymbol{n}+\boldsymbol{v}\cdot\chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{q})\boldsymbol{n}~\mathrm{d}s.\\
\end{aligned}\]</p><p>As a result the partial derivatives of <span>$\hat{\mathcal{L}}$</span> in <span>$\boldsymbol{v}$</span> and <span>$\boldsymbol{q}$</span> are the same as previously up to relaxation over <span>$D$</span>, i.e.,</p><p class="math-container">\[\begin{aligned}
0=\frac{\partial\hat{\mathcal{L}}}{\partial\boldsymbol{q}}(\boldsymbol{\phi})&amp;=\int_D\boldsymbol{\phi}\cdot(-\mathrm{div}(\chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{u}))-(1-H(\varphi))\boldsymbol{f})~\mathrm{d}\boldsymbol{x}+\int_{\Gamma_R}\boldsymbol{\phi}\cdot(\chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{v})\boldsymbol{n}+\boldsymbol{w}(\boldsymbol{v}))~\mathrm{d}s\\
&amp;\quad+\int_{\Gamma_N}\boldsymbol{\phi}\cdot(\chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{v})\boldsymbol{n}-\boldsymbol{g})~\mathrm{d}s-\int_{\Gamma_D}\boldsymbol{v}\cdot\chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{\phi})\boldsymbol{n}~\mathrm{d}s+\int_{\Gamma_0}\boldsymbol{\phi}\cdot\chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{v})\boldsymbol{n}~\mathrm{d}s
\end{aligned}\]</p><p>and</p><p class="math-container">\[\begin{aligned}
0=\frac{\partial\hat{\mathcal{L}}}{\partial\boldsymbol{v}}(\boldsymbol{\phi})&amp;=\int_D \boldsymbol{\phi}\cdot(-\mathrm{div}(\chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{q}))-(1-H(\varphi))j^\prime(\boldsymbol{v}))~\mathrm{d}\boldsymbol{x}+\int_{\Gamma_N} \boldsymbol{\phi}\cdot (\chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{q})\boldsymbol{n}+l_1^\prime(\boldsymbol{v}))~\mathrm{d}s\\
&amp;\quad+\int_{\Gamma_R} \boldsymbol{\phi}\cdot (\chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{q})\boldsymbol{n}+w^\prime(\boldsymbol{v})\cdot\boldsymbol{q}+l_2^\prime(\boldsymbol{v}))~\mathrm{d}s-\int_{\Gamma_D}\boldsymbol{q}\cdot\chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{\phi})\boldsymbol{n}~\mathrm{d}s\\
&amp;\quad+\int_{\Gamma_0}\boldsymbol{\phi}\cdot\chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{q})\boldsymbol{n}~\mathrm{d}s.
\end{aligned}\]</p><p>Therefore, we may identify <span>$\boldsymbol{v}=\boldsymbol{u}$</span> and <span>$\boldsymbol{q}=\boldsymbol{\lambda}$</span> where the latter satisfies the adjoint equation</p><p class="math-container">\[\begin{aligned}
-\mathrm{div}(\chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{\lambda})) &amp;= (1-H(\varphi))j^\prime(\boldsymbol{u})\text{ on }\Omega, \\
\boldsymbol{\lambda} &amp;= \boldsymbol{0}\text{ on }\Gamma_D,\\
\chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{\lambda})\boldsymbol{n} &amp;= \boldsymbol{0} \text{ on }\Gamma_0,\\
\chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{\lambda})\boldsymbol{n} &amp;= -l_1^\prime(\boldsymbol{u})\text{ on }\Gamma_N,\\
\chi_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{\lambda})\boldsymbol{n} &amp;= -w^\prime(\boldsymbol{u})\cdot\boldsymbol{\lambda}-l_2^\prime(\boldsymbol{u}) \text{ on }\Gamma_R.\\
\end{aligned}\]</p><p>This exactly as previously up to relaxation over <span>$D$</span>. Finally, The derivative of <span>$\hat{J}(\varphi)=\hat{\mathcal{L}}(\varphi,\boldsymbol{u},\boldsymbol{\lambda})$</span> then follows by application of the chainrule as previously:</p><p class="math-container">\[\begin{aligned}
\hat{J}^\prime(\varphi)(v)&amp;=\frac{\partial\hat{\mathcal{L}}}{\partial\varphi}(\varphi,\boldsymbol{u},\boldsymbol{\lambda})(v)+\cancel{\frac{\partial\hat{\mathcal{L}}}{\partial\boldsymbol{v}}(\varphi,\boldsymbol{u},\boldsymbol{\lambda})}(\boldsymbol{u}^\prime(v))+\cancel{\frac{\partial\hat{\mathcal{L}}}{\partial\boldsymbol{q}}(\varphi,\boldsymbol{u},\boldsymbol{\lambda})}(\boldsymbol{\lambda}^\prime(v))\\
&amp;=\int_D v(\chi^\prime_\epsilon(\varphi)\boldsymbol{C\varepsilon}(\boldsymbol{u})\boldsymbol{\varepsilon}(\boldsymbol{\lambda})+(-H^\prime(\varphi))j(\boldsymbol{u})- (-H^\prime(\varphi))\boldsymbol{f}\cdot\boldsymbol{\lambda})~\mathrm{d}\boldsymbol{x}\\
&amp;=-\int_D v(\boldsymbol{C\varepsilon}(\boldsymbol{u})\boldsymbol{\varepsilon}(\boldsymbol{\lambda})+j(\boldsymbol{u})- \boldsymbol{f}\cdot\boldsymbol{\lambda})H^\prime(\varphi)~\mathrm{d}\boldsymbol{x}+\epsilon\int_D v\boldsymbol{C\varepsilon}(\boldsymbol{u})\boldsymbol{\varepsilon}(\boldsymbol{\lambda})H^\prime(\varphi)~\mathrm{d}\boldsymbol{x}
\end{aligned}\]</p><p>where we have used that <span>$v=0$</span> on <span>$\Gamma_D$</span> as previously. As previously taking <span>$\boldsymbol{\theta}=v\boldsymbol{n}$</span> and relaxing the shape derivative of <span>$J$</span> over <span>$D$</span> with a signed distance function <span>$\varphi$</span> yields:</p><div class="admonition is-success"><header class="admonition-header">Result II</header><div class="admonition-body"><p class="math-container">\[{\huge{|}} J^\prime(\Omega)(v\boldsymbol{n}) - \hat{\mathcal{J}}^\prime(\varphi)(v){\huge{|}}=O(\epsilon).\]</p></div></div><p>As required.</p><h2 id="What-is-not-captured-by-a-Gâteaux-derivative-at-\\varphi?"><a class="docs-heading-anchor" href="#What-is-not-captured-by-a-Gâteaux-derivative-at-\\varphi?">What is not captured by a Gâteaux derivative at <span>$\varphi$</span>?</a><a id="What-is-not-captured-by-a-Gâteaux-derivative-at-\\varphi?-1"></a><a class="docs-heading-anchor-permalink" href="#What-is-not-captured-by-a-Gâteaux-derivative-at-\\varphi?" title="Permalink"></a></h2><p>Owing to a fixed computational regime we do not capture a variation of the domain <span>$\Omega$</span> in <span>$\varphi$</span>, so the Gâteaux derivative of certain types of functionals in this context will not match the shape derivative. For example, in the discussion above the shape derivative of <span>$J_2$</span> and the Gâteaux derivative of <span>$J_{2\Omega}$</span> fail to match even in the relaxed setting. Regardless of this, accurate resolution of <span>$J_2$</span> is difficult owing to the appearance of mean curvature. This problem is further exacerbated when a discretisation of the boundary is not available.</p><p>In addition, functionals of the signed distance function posed over the whole bounding domain <span>$D$</span> admit a special structure under shape differentiation (<a href="https://doi.org/10.1051/m2an/2019056">Paper</a>). Such cases are not captured by a Gâteaux derivative at <span>$\varphi$</span> under relaxation.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>In future, we plan to implement CellFEM via GridapEmbedded in GridapTopOpt. This will enable Gâteaux derivative of the mapping</p><p class="math-container">\[\varphi \mapsto \int_{\Omega(\varphi)}f(\varphi)~\mathrm{d}\boldsymbol{x} + \int_{\Omega(\varphi)^\complement}f(\varphi)~\mathrm{d}\boldsymbol{x}.\]</p><p>We expect this to rectify the discussion above.</p></div></div></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Thursday 23 January 2025 00:23">Thursday 23 January 2025</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
